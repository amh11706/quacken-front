<div class="chatbox">
  <div class="output">
    <cdk-virtual-scroll-viewport class="textbox"
      [itemSize]="27"
      [minBufferPx]="100"
      [maxBufferPx]="200"
      (wheel)="scrolled($event)"
      (scroll)="scrolledAny($event)">
      <div *cdkVirtualFor="let m of chat.messages$"
        class="message">
        <p [style.backgroundColor]="colors[m.type]"
          [matTooltipShowDelay]="500"
          [matTooltipPosition]="'right'"
          [matTooltip]="m.receivedTime">
          @switch (m.type) {
            @case (0) {
              <span>{{m.message}}</span>
            }
            @case (1) {
              <span
              [innerHTML]="m.message"></span>
            }
            @case (2) {
              <span>
                <q-name [message]="m"></q-name>
                says "{{m.message}}"
              </span>
            }
            @case (3) {
              <span>
                <q-name [message]="m"></q-name>
                {{m.message}}
              </span>
            }
            @case (4) {
              <span>
                You told
                <q-name [message]="m"></q-name>
                "{{m.message}}"
              </span>
            }
            @case (5) {
              <span>
                <q-name [message]="m"></q-name>
                tells you
                "{{m.message}}"
              </span>
            }
            @case (6) {
              <span>
                {{m.from ? m.from + ' says "' + m.message + '"' : m.message}}
              </span>
            }
            @case (7) {
              <span>
                <q-name [message]="m"
                [offline]="true"></q-name> was last seen
                {{m.ago}} ({{m.time}}).
              </span>
            }
            @case (8) {
              <span
                class="invite">
                @if (m.message.ty === 0) {
                  <span>
                    <q-name [message]="m"></q-name> has requested to add you as a friend.
                  </span>
                } @else {
                  <span>
                    <q-name [message]="m"></q-name> has invited you to join their lobby.
                  </span>
                }
                @if (!m.message.resolved) {
                  @if (m.message.ty !== 0) {
                    <a
                      mat-raised-button
                      color="accent"
                      class="accept"
                      [href]="'/#/lobby/' + m.message.tg"
                    (click)="accept(m.message)">Accept</a>
                  } @else {
                    <button mat-raised-button
                      color="accent"
                      class="accept"
                    (click)="accept(m.message)">Accept</button>
                  }
                  <button mat-raised-button
                  (click)="decline(m.message)">Decline</button>
                }
              </span>
            }
            @case (9) {
              <span>
                <q-name [message]="m"></q-name>
                broadcasts "{{m.message}}"
              </span>
            }
            @case (10) {
              <span>
                <q-name [message]="m"></q-name>
                team chats "{{m.message}}"
              </span>
            }
          }
        </p>
      </div>
    </cdk-virtual-scroll-viewport>
  </div>

  <q-input [disabled]="disabled"></q-input>
</div>
